---
title: "Introduction to R"
author: "Giulio A. De Leo"
date: "12/22/2021"
output: pdf_document
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.height = 3, fig.width = 5, message = FALSE, warning = FALSE)

```

### Introduction to R

# *For* loop to simulate Malthusian growth

Here we will use *R* and *RMarkdown* to simulate Malthusian growth for a population of lionfish *Pterois miles* and *P. volitans* in the Caribbean.

First, it is always a good habit to clear R's memory. This time, we do it explicitly, we won't show it in following *RMarkdown* exercises, but it will be there.

```{r clean}
rm(list=ls(all=TRUE)) 
```

The growth rate of lion fish was derived from *Morris et al.* (2011, *Biological Invasions*):

```{r}
lambda  <- 1.12
```

Assume the current number of individuals per hectare is still very low, at the beginning of the invasion (from Whitfield et al. 2007, *Biological Invasions*):

```{r}
N0  <- 2.0 
```

We can use R to calculate lionfish density in the next generation:

```{r}
N2  <- lambda * N0; N2
```

Needless to say, we can do better than this and, for instance, compute lionfish density in 10 generations:

```{r}
N10 <- (lambda^10)*N0; sprintf("%.2f", N10) # print only two significant digits
```

In this case we have the analytic formula to derive lionfish density at any future generation. In general, however, model complexity requires to work with a recursive formula, one step at a time. Let's see how we do it. We need to write a "for loop" to compute number of individuals in the population at time *t+1* as a function of population at time *t*.

Let's first set time horizon (for instance, 20 years):

```{r}
tmax <-  20 
```

We also create a vector to store pop abundance at time *t*, with length *tmax*, namely:

```{r}
nt <- numeric(tmax) 
```

Let's assign the initial population density to the first element of this vector

```{r}
nt[1] <- N0 
```

Here is the simple *for* loop

```{r}
for (t in 1:(tmax-1)) {

  nt[t+1] <- lambda * nt[t]
	
}
```

We can print on screen the first elements of the vector

```{r}
sprintf("%.2f", head(nt))
```

and the last ones"

```{r}
sprintf("%.2f", tail(nt))
```

...or extract any element form the vector at a time point

```{r}
sprintf("%.2f", c(nt[1], nt[5], nt[15]))

```

Anyway, it might be useful just to plot the result, i.e., population density vs time. 
To do so, we need to (1) install the ggplo2 package (if you haven't install it yet), (2) load the package, (3) create a *data frame*, as shown hereafter:

```{r}
if (!require("ggplot2")) install.packages("ggplot2")
library(ggplot2)

df <- data.frame(years=1:tmax, density=nt)
```

and then build up the plot:

```{r}
ggplot() +
geom_step(data=df,  mapping=aes(x=years, y=nt)) +  # set the set wise geometry
geom_point(data=df, mapping=aes(x=years, y=nt ), color="red") + #the red points
geom_line(data=df, mapping=aes(x=years, y=nt ), color = "darkgrey", linetype=3) + # a dotted line
  ggtitle("Population trend") +  # the tite
  xlab("Time [years]") + ylab("Density [ind./ha]") # the axis label

```

I can also plot it on a semi-log scale

```{r}
ggplot() +
geom_step(data=df,  mapping=aes(x=years, y=nt)) +
geom_point(data=df, mapping=aes(x=years, y=nt ), color="red") +
geom_line(data=df, mapping=aes(x=years, y=nt ), color = "darkgrey", linetype=3) +
  ggtitle("Population trend") +
  xlab("Time [years]") + ylab("Density [ind./ha]") +
   scale_y_log10() 
```

### Assignment
How does the geometric growth look like when you plot population trend in a semilog scale?  
<br/><br/>

Finally, I can compute the expected number of generations the population is projected to take on average to double the initial density.

To do so, let's consider that:

$$
N_{x} =  2N_0 = {\lambda}^x  N_0
$$ 

We can divide each member of the equation by $N_0$ (\>0):

$$
2 = {\lambda}^x
$$

take the natural logarithm:

$$
\log 2 = \log {\lambda}^x = x * \log({\lambda})
$$ 

which can be solved for *x* as:

$$
x = \frac{\log 2}{\log({\lambda})}
$$

Therefore, the doubling time [years] is:

```{r}
DT <- log(2)/log(lambda)
sprintf("%.1f", DT)

```

### Assignment

How long did the population took to become 10 times larger, i.e., around \~20 ind/ha, from an initial density of about 2 ind./ha, as reported by Whitfield et al. (2007, *Biological Invasions*)?
